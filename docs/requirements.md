# 業務要件

## 背景・課題

料理やお菓子作りで「手元にある材料の量」に合わせてレシピ全体を調整したい場面がある。

- 小麦粉が135g余っている → 元レシピは100g基準 → 全材料を1.35倍にしたい
- 型のサイズが違うので半量で作りたい
- 手計算は面倒でミスが起きやすい

## ユーザーストーリー

### US-1: レシピを登録する

> ユーザーとして、基準となるレシピ（材料名・量・単位）を登録したい。計算の元データとして使うため。

**受け入れ条件**:
- レシピ名（必須）と説明（任意）を入力できる
- 材料を動的に追加・削除できる
- 各材料には名前・量・単位を入力できる
- 材料は2つ以上必要
- 量は0より大きい数値のみ許可
- 単位のデフォルトは「g」
- 保存後、一覧画面に即座に反映される

### US-2: レシピを編集・削除する

> ユーザーとして、登録済みのレシピを修正・削除したい。分量の誤りや不要なレシピを整理するため。

**受け入れ条件**:
- 一覧画面またはスケーリング画面から編集画面に遷移できる
- 既存の値が入力欄にプリセットされる
- 削除時は確認ダイアログを表示する

### US-3: 材料の量を変更して全体をスケーリングする（コア機能）

> ユーザーとして、任意の材料の量を変更したとき、他の全材料が同じ比率で自動的に再計算されてほしい。手計算なしで正確な分量を知るため。

**受け入れ条件**:
- いずれかの材料の値を変更すると、他の全材料がリアルタイムに更新される
- 現在の倍率（例: x1.35）が画面上部に表示される
- 基準値が各材料の横に参考表示される
- リセットボタンで基準値に戻せる
- 入力中のフィールドのカーソル位置が飛ばない

**計算ルール**:
- `ratio = 変更後の値 / 変更した材料の基準量`
- `他の材料 = その材料の基準量 × ratio`
- 常に基準量から計算する（連鎖計算による累積誤差を防止）
- 基準量が0の材料は計算対象外
- 入力値が0以下の場合は再計算しない

### US-4: 調整結果を記録する

> ユーザーとして、スケーリング後の材料一覧をメモ付きで保存したい。後で同じ分量で作りたいとき、もう一度計算し直す手間を省くため。

**受け入れ条件**:
- 計算画面から「記録」ボタンで保存ダイアログを表示
- メモ（任意）を入力して保存できる
- 保存時の倍率・全材料の計算値・日時が記録される
- レシピごとの記録履歴を一覧表示できる
- レシピ一覧画面から記録履歴に直接遷移できる（記録件数バッジ付き）
- 記録を個別に削除できる（確認ダイアログ付き）

## 画面一覧

| # | 画面名 | 主な操作 |
|---|--------|----------|
| 1 | レシピ一覧 | レシピの閲覧・削除、計算画面/記録画面への遷移、新規作成への遷移 |
| 2 | レシピ作成/編集 | レシピ情報・材料リストの入力、保存 |
| 3 | スケーリング計算 | 材料の値変更、リアルタイム再計算、リセット、記録保存、編集/記録履歴への遷移 |
| 4 | 記録履歴 | 保存済みの調整記録の閲覧・削除 |

## 画面遷移

```
レシピ一覧
  ├── [+ボタン] → レシピ作成
  ├── [カードタップ] → スケーリング計算
  │     ├── [編集アイコン] → レシピ編集
  │     ├── [履歴アイコン] → 記録履歴
  │     └── [記録ボタン] → 保存ダイアログ
  └── [履歴アイコン] → 記録履歴（直接遷移）
```

## データモデル

### レシピ (MasterRecipe)

| フィールド | 型 | 説明 |
|-----------|------|------|
| id | String (UUID) | 一意識別子 |
| name | String | レシピ名（必須） |
| description | String | 説明（任意） |
| ingredients | List\<IngredientItem\> | 材料リスト |
| createdAt | DateTime | 作成日時 |

### 材料 (IngredientItem)

| フィールド | 型 | 説明 |
|-----------|------|------|
| id | String (UUID) | 一意識別子 |
| name | String | 材料名 |
| baseAmount | double | 基準量（レシピ原本の値） |
| currentAmount | double | 計算後の量 |
| unit | String | 単位（デフォルト: g） |

### 調整記録 (AdjustmentNote)

| フィールド | 型 | 説明 |
|-----------|------|------|
| id | String (UUID) | 一意識別子 |
| recipeId | String | 紐づくレシピのID |
| recipeName | String | レシピ名（表示用） |
| adjustedIngredients | List\<IngredientItem\> | 調整後の材料リスト |
| ratio | double | 倍率 |
| memo | String | メモ（任意） |
| createdAt | DateTime | 作成日時 |

## バリデーションルール

| 対象 | ルール |
|------|--------|
| レシピ名 | 空文字不可 |
| 材料数 | 2つ以上 |
| 材料の量 | 0より大きい数値 |
| 入力制限 | 数字と小数点のみ（`[\d.]`） |
| 計算時 | 基準量が0の材料はスキップ、入力値が0以下なら再計算しない |

## 非機能要件

| 項目 | 内容 |
|------|------|
| ストレージ | ローカルのみ（shared_preferences + JSON） |
| オフライン | 完全オフライン動作（ネットワーク不要） |
| データ量目安 | レシピ数十〜数百件を想定 |
| 精度 | 内部は double 完全精度、表示は小数点以下1桁 |
